<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="stylesheet" type="text/css" href="elechart/serviceform.css">
		<script defer src="scripts/clientutils.js"></script>
	</head>
	<body>
		<h2>Appointment Registration Form</h2>
		<form class="row g-3" action="#" method="post">
			<fieldset>
				<legend>Patient Name</legend>
				<label for="fName" class="form-label">First</label>
				<input type="text" class="form-control" id="fName">
			
				<label for="lName" class="form-label">Last</label>
				<input type="text" class="form-control" id="lName">
			</fieldset>
			
			<fieldset>
				<legend>Contact</legend>
				<label for="phone" class="form-label">Contact Number</label>
				<input type="text" class="form-control" id="phone" placeholder="555 555 555">

				<label for="email" class="form-label">Email Address</label>
				<input type="text" class="form-control" id="email" placeholder="john@example.com">
			</fieldset>

			<fieldset>
				<legend>Appointment Details</legend>
				<label for="doctor" class="form-label">Preferred Doctor</label>
				<input type="text" class="form-control" id="doctor" placeholder="Leave blank if you do not have a preferred doctor">

				<label for="appointment">Preferred Appointment Date and Time</label>
				<input type="datetime-local" id="appointment" name="appointment">
				
				<label for="reason">Reason for Visit</label>
				<textarea class="form-control" placeholder="Comment here" id="reason" style="height: 100px"></textarea>
			</fieldset>
			
			<!-- Submit button -->
			<button type="submit" class="btn btn-success" onclick="submitAppointmentForm()">Make Appointment</button>
		</form>
	</body>
</html>
<script>
	function submitAppointmentForm() {
		var accessToken = clientUtils.getCookie("accessToken");
		var clientId = clientUtils.getCookie("clientID");
		var postType = "submitAppointmentForm";
	
		var firstname = document.getElementById('fName').value;
		var lastname = document.getElementById('lName').value;
		var email = document.getElementById('email').value;
		var phonenumber = document.getElementById('phone').value;
		var physician = document.getElementById('doctor').value;
		var appointment = document.getElementById('appointment').value;
		var reasonForVisit = document.getElementById('floatingTextarea2').value;
	
		var obj = {
			"accessToken": accessToken,
			"clientId": clientId,
			"postType": postType,
			"firstname": firstname,
			"lastname": lastname,
			"email": email,
			"phonenumber": phonenumber,
			"physician": physician,
			"date": appointment,
			"reason": reasonForVisit
	
		};
	
		fetch('localhost', {
			method: 'POST',
			mode: "cors",
			headers: {
				'Accept': 'application/json',
				'Content-Type': 'application/json'
			},
			body: JSON.stringify(obj)
		})
			.then(response => response.json())
			.then(response => handleResponse(JSON.stringify(response)));
	}
	
	function handleResponse(response) {
		console.log("Handle: " + response);
		var obj = JSON.parse(response);
		var outcome = obj["outcome"];
		var respType = obj["responseType"];
		console.log("Outcome: " + outcome);
	
		if (outcome == "failed") {
			alert("Post Failed: " + respType);
		}
		else if (outcome == "success") {
			parent.location.reload();
		}
	}
</script>