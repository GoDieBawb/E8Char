<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="icon" type="image/x-icon" href="images/favicon.ico">
		<link rel="stylesheet" type="text/css" href="bootstrap/bootstrap.css">
		<link rel="stylesheet" type="text/css" href="elechart/elechart.css">
		<script defer src="scripts/clientutils.js"></script>
		<title>Login</title>
	</head>
	<body id="login-background">
		<div class="container">
			<div class="row justify-content-center mt-4">
				<div class="col-6">
					<div class="row justify-content-center">
						<img id="elechart-logo" src="images/Elephant.png"><br>
					</div>
					<div class="row justify-content-center">
						<img id="elechart-title" src="images/elechart-title.png" alt="EleChart">
					</div>
					<div class="bg-white rounded border row justify-content-center p-3 mt-4 elechart-style-1">
						<form id="login-form">
							<h2 class="text-center m-0">Portal Sign-In</h2>
							<div class="row justify-content-center">
								<label class="fs-5" for="username-input">Username</label>
								<input id="username-input" type="text" name="username" autocomplete="username" required>
							</div>
							<div class="row justify-content-center mt-2">
								<label class="fs-5" for="password-input">Password</label>
								<input id="password-input" type="password" name="password" required>
							</div>
							<div class="row justify-content-center mt-4">
								<button class="btn btn-success fs-5" id="login-button" type="submit" onclick="attemptLogin()">Sign In</button>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>
<script>
	var loginDebounce = false;

	function attemptLogin() {
		event.preventDefault();
		
		if (loginDebounce)
			return;
		else
			loginDebounce = true;

		const accessToken = "None";
		const postType = "Login";
		const formData = clientUtils.getFormData(document.querySelector("#login-form"));
		
		const newClientPost = new clientUtils.ClientPost(postType, accessToken, responseCallback);
		newClientPost.addParam("username", formData.username);
		newClientPost.addParam("password", formData.password);

		clientUtils.webPost(newClientPost);

		document.querySelector("#login-button").classList.add("active");
	}

	function responseCallback(serverResponse) {
		if (serverResponse.outcome == "failed") {
			alert("Login Failed");

			document.querySelector("#login-button").classList.remove("active");
			loginDebounce = false;
		}
		else if (serverResponse.outcome == "success") {
			clientUtils.setCookie("accessToken", serverResponse.accessToken);
			clientUtils.setCookie("physicianName", serverResponse.physicianName);
			clientUtils.goto("PatientInquiry");
		}
	}
</script>