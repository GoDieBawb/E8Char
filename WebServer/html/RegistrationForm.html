<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="stylesheet" type="text/css" href="elechart/serviceform.css">
		<script defer src="scripts/clientutils.js"></script>
	</head>
	<body>
		<h2>Patient Registration Form</h2>
		<form id="main-form" method="post">
			<!-- Patient Information -->
			<fieldset>
				<legend>Patient Name & Birth</legend>
				<label for="firstname">First Name:</label>
				<input type="text" id="firstname" name="firstName" required>

				<label for="lastname">Last Name:</label>
				<input type="text" id="lastname" name="lastName" required>

				<label for="dob">DOB:</label>
				<input type="date" id="dob" name="dob" required>
			</fieldset>

			<fieldset>
				<legend>Contact</legend>
				<label for="prim-lang">Primary Language:</label>
				<select id="prim-lang" name="primaryLanguage" required>
					<option value="null">Select primary language</option>
				</select>

				<label for="phonenumber">Phone Number:</label>
				<input type="text" id="phonenumber" name="phoneNumber" required>

				<label for="emergency-phone">Emergency Phone:</label>
				<input type="text" id="emergency-phone" name="emergencyPhone" required>

				<label for="address">Address:</label>
				<input type="text" id="address" name="address" autocomplete="street-address" required>

				<label for="city">City:</label>
				<input type="text" id="city" name="city" required>

				<label for="state">State:</label>
				<input type="text" id="state" name="state" required>

				<label for="zip">Zip:</label>
				<input type="number" id="zip" name="zip" required>

				<label for="ssn">Social Security Number:</label>
				<input type="number" id="ssn" name="ssn" required>

				<label for="pharmacy">Pharmacy Name:</label>
				<input type="text" id="pharmacy" name="pharmacy" required>

				<label for="insurance">Insurance:</label>
				<input type="text" id="insurance" name="insurance" required>

				<label for="insurance-id">Insurance Identification Number:</label>
				<input type="number" id="insurance-id" name="insuranceId" required>
			</fieldset>

			<fieldset>
				<legend>Diversity & Physicality</legend>
				<label for="ethnicity">Ethnicity:</label>
				<select id="ethnicity" name="ethnicity" required>
					<option value="null">Select ethnicity</option>
				</select>

				<label for="race">Race:</label>
				<select id="race" name="race" required>
				</select>

				<label for="sex">Sex:</label>
				<select id="sex" name="sex" required>
				</select>

				<label for="weight">Weight (lb.):</label>
				<input type="number" id="weight" name="weight" required>
			</fieldset>

			<!-- The submit button function -->
			<button onclick="submitDemographic()" type="submit" class="btn btn-primary">Submit Registration</button>
		</form>
	</body>
</html>
<script>
	function submitDemographic() {
		event.preventDefault();
		
		const accessToken = clientUtils.getCookie("accessToken");
		const clientId = clientUtils.getCookie("clientID");
		const postType = "patientRegistrationFormPost";
		const formData = clientUtils.getFormData(document.querySelector("#main-form"));
	
		const newClientPost = new clientUtils.ClientPost(postType, accessToken, responseCallback);
		newClientPost.addParam("clientId", clientId);
		
		for (const key in formData)
			newClientPost.addParam(key, formData[key]);

		clientUtils.webPost(newClientPost);
	}

	function responseCallback(serverResponse) {
		if (serverResponse.outcome == "failed") {
			alert("Post Failed: " + serverResponse.responseType);
		}
		else if (serverResponse.outcome == "success") {
			parent.location.reload();
		}
	}

	function onPageLoaded() {
		let primLangList = document.querySelector("#ethnicity");
		let ethnicityList = document.querySelector("#prim-lang");

		primaryLanguages.forEach((lang) => {
			primLangList.innerHTML += `<option value="${lang}">${lang}</option>`;
		});

		ethnicities.forEach((ethn) => {
			ethnicityList.innerHTML += `<option value="${ethn}">${ethn}</option>`;
		});
		
	}

	document.addEventListener("DOMContentLoaded", onPageLoaded, false);
</script>