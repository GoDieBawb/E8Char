<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="stylesheet" type="text/css" href="elechart/serviceform.css">
		<script defer src="scripts/clientutils.js"></script>
	</head>
	<body>
		<h2>Surgical History Form</h2>
		<form action="#" method="post">
			<fieldset>
				<legend>Patient Information</legend>
				<label for="patientName" class="form-label">Patient Name:</label>
				<input type="text" id="patientName" name="patientName" class="form-input" required>

				<label for="dateOfBirth" class="form-label">Date of Birth:</label>
				<input type="date" id="dateOfBirth" name="dateOfBirth" class="form-input" required>

				<label for="medicalRecordNumber" class="form-label">Medical Record Number:</label>
				<input type="text" id="medicalRecordNumber" name="medicalRecordNumber" class="form-input" required>
			</fieldset>

			<fieldset>
				<legend>Current Surgery</legend>
				<input type="text" id="currentSurgeryName" name="currentSurgeryName" class="form-input mb-2" placeholder="Surgery Name">
				<input type="date" id="dateOfSurgery" name="dateOfSurgery" class="form-input mb-2" placeholder="Date of Surgery">
				<input type="text" id="insuranceInfo" name="insuranceInfo" class="form-input mb-2" placeholder="Insurance Information">
				<textarea id="surgeryDetails" name="surgeryDetails" class="form-input mb-2" rows="4" placeholder="Details of Surgery"></textarea>
				<input type="text" id="doctorName" name="doctorName" class="form-input mb-2" placeholder="Doctor's Name">
			</fieldset>

			<fieldset>
				<legend>Past Surgeries</legend>
				<label class="form-label">Past Surgeries (if any):</label>
				<div id="pastSurgeriesContainer">
					<!-- Past Surgeries Fields will be dynamically added here -->
				</div>
				<button type="button" class="btn btn-secondary mb-3" onclick="addPastSurgery()">Add Past Surgery</button>
			</fieldset>

			<!-- Submit button -->
			<button class="btn-submit" onclick="submitSurgicalHistory()">Submit</button>
		</form>
	</body>
</html>
<script>
	/**
	* Function to add a new past surgery input field to the pastSurgeriesContainer.
	*/
	
	function addPastSurgery() {
		// Retrieve the element in the container that has the history of surgeries.
		const pastSurgeriesContainer = document.getElementById('pastSurgeriesContainer');
		// HTML template for new input fields for previous surgeries.
		const pastSurgeryFields = `
			<div class="mb-3">
				<input type="text" class="form-input mb-2" placeholder="Surgery Name">
				<input type="date" class="form-input mb-2" placeholder="Date of Surgery">
				<textarea class="form-input mb-2" rows="4" placeholder="Details of Surgery"></textarea>
			</div>
		`;
		// At the end, insert the HTML for the new prior surgery input fields into the container.
		pastSurgeriesContainer.insertAdjacentHTML('beforeend', pastSurgeryFields);
	}
	
	function submitSurgicalHistory() {
		var accessToken = clientUtils.getCookie("accessToken");
		var postType = "submitSurgicalHistory";
	
		var patientName = document.getElementById('patientName').value;
		var dateOfBirth = document.getElementById('dateOfBirth').value;
		var medicalRecordNumber = document.getElementById('medicalRecordNumber').value;
		var dateOfSurgery = document.getElementById('dateOfSurgery').value;
		var insuranceInfo = document.getElementById('insuranceInfo').value;
		var surgeryDetails = document.getElementById('surgeryDetails').value;
		var doctorName = document.getElementById('doctorName').value;
	
		var obj = {
			"accessToken": accessToken,
			"postType": postType,
			"patientName": patientName,
			"dateOfBirth": dateOfBirth,
			"medicalRecordNumber": medicalRecordNumber,
			"dateOfSurgery": dateOfSurgery,
			"insuranceInfo": insuranceInfo,
			"surgeryDetails": surgeryDetails,
			"doctorName": doctorName
		};
	
		fetch('localhost', {
			method: 'POST',
			mode: 'cors',
			headers: {
				'Accept': 'application/json',
				'Content-Type': 'application/json'
			},
			body: JSON.stringify(obj)
		})
		.then(response => response.json())
		.then(response => handleResponse(response))
		.catch(error => console.error('Error submitting form:', error));
	}
	
	function handleResponse(response) {
		var obj = JSON.parse(response);
		var outcome = obj.outcome;
		var respType = obj.responseType;
	
		if (outcome == "failed") {
			alert("Post Failed: " + respType);
		}
		else if (outcome == "success") {
			parent.location.reload();
		}
	}
</script>